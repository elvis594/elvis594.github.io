<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED CONTROL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ffffff;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1),
                        0 0 0 1px rgba(255, 255, 255, 0.2);
            width: 100%;
            max-width: 600px;
        }
        
        /* Âè≥‰∏äËßíÈÄöÁü•Ê†∑Âºè */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            min-width: 300px;
            max-width: 400px;
            padding: 16px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .toast-notification.show {
            transform: translateX(0);
        }
        
        .toast-notification.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.9) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .toast-notification.info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9) 0%, rgba(29, 78, 216, 0.9) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .toast-notification.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.9) 0%, rgba(217, 119, 6, 0.9) 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .toast-notification.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9) 0%, rgba(220, 38, 38, 0.9) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .toast-message {
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* Ëá™ÂÆö‰πâÂºπÁ™óÊ†∑Âºè */
        .custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .custom-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3),
                        0 0 0 1px rgba(255, 255, 255, 0.3);
            transform: scale(0.8) translateY(20px);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .custom-modal.show .modal-content {
            transform: scale(1) translateY(0);
        }
        
        .modal-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }
        
        .modal-icon.success {
            color: #10b981;
        }
        
        .modal-icon.error {
            color: #ef4444;
        }
        
        .modal-icon.warning {
            color: #f59e0b;
        }
        
        .modal-icon.info {
            color: #3b82f6;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .modal-message {
            font-size: 16px;
            color: #4b5563;
            line-height: 1.5;
            margin-bottom: 25px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }
        
        .modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .modal-btn.secondary {
            background: rgba(107, 114, 128, 0.1);
            color: #4b5563;
            border: 1px solid rgba(107, 114, 128, 0.2);
        }
        
        .modal-btn.secondary:hover {
            background: rgba(107, 114, 128, 0.2);
            transform: translateY(-1px);
        }
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            font-size: 32px;
            font-weight: 600;
            color: #ffffff;
            margin: 0;
            text-align: left;
            letter-spacing: 0.02em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
            transition: all 0.3s ease;
        }
        
        .status-indicator.connected {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            margin-top: 40px;
        }

        .connect-button {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }
        
        .connect-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .connect-button:hover::before {
            left: 100%;
        }
        
        .usb-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4), 0 0 20px rgba(118, 75, 162, 0.3);
        }
        
        .usb-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6), 0 0 30px rgba(118, 75, 162, 0.5);
        }
        
        .ble-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #ff9ff3 100%);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4), 0 0 20px rgba(238, 90, 36, 0.3);
        }
        
        .ble-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(255, 107, 107, 0.6), 0 0 30px rgba(238, 90, 36, 0.5);
        }
        
        .connect-button.connected {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4), 0 0 20px rgba(76, 175, 80, 0.3); }
            50% { box-shadow: 0 12px 35px rgba(76, 175, 80, 0.7), 0 0 40px rgba(76, 175, 80, 0.6); }
            100% { box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4), 0 0 20px rgba(76, 175, 80, 0.3); }
        }
        
        .connect-button:active {
            transform: scale(0.98);
        }

        .usb-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #43e97b 100%);
            color: #ffffff;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4), 0 0 20px rgba(0, 242, 254, 0.3);
        }
        
        .usb-button:hover {
            box-shadow: 0 12px 35px rgba(79, 172, 254, 0.6), 0 0 30px rgba(0, 242, 254, 0.5);
        }
        
        .usb-button.connected {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 50%, #ff6b9d 100%);
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.4), 0 0 20px rgba(255, 75, 43, 0.3);
        }
        
        .usb-button.connected:hover {
            box-shadow: 0 12px 35px rgba(255, 65, 108, 0.6), 0 0 30px rgba(255, 75, 43, 0.5);
        }

        .ble-button {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 50%, #ff6b9d 100%);
            color: #ffffff;
            box-shadow: 0 8px 25px rgba(250, 112, 154, 0.4), 0 0 20px rgba(254, 225, 64, 0.3);
        }
        
        .ble-button:hover {
            box-shadow: 0 12px 35px rgba(250, 112, 154, 0.6), 0 0 30px rgba(254, 225, 64, 0.5);
        }
        
        .ble-button.connected {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 50%, #ff6b9d 100%);
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.4), 0 0 20px rgba(255, 75, 43, 0.3);
        }
        
        .ble-button.connected:hover {
            box-shadow: 0 12px 35px rgba(255, 65, 108, 0.6), 0 0 30px rgba(255, 75, 43, 0.5);
        }


        /* ÂºÄÂÖ≥Êéß‰ª∂Ë°åÊ†∑Âºè */
        .switches-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        /* Êéß‰ª∂ÁªÑÊ†∑Âºè */
        .control-group {
            margin-bottom: 32px;
        }
        
        .switches-row .control-group {
            margin-bottom: 0;
            text-align: center;
        }
        
        .switches-row .control-group label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 16px;
            letter-spacing: 0.02em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .control-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 12px;
            letter-spacing: 0.02em;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }
        
        /* ÂºÄÂÖ≥ÊåâÈíÆÊ†∑Âºè */
        .switch-container {
            display: flex;
            justify-content: center;
        }
        
        .switch-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            min-width: 120px;
            letter-spacing: 0.02em;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
        }
        
        .switch-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .switch-btn:hover::before {
            left: 100%;
        }
        
        .switch-btn.off {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 50%, #ff6b9d 100%);
            color: #ffffff;
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.4), 0 0 20px rgba(255, 75, 43, 0.3);
        }
        
        .switch-btn.on {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 50%, #4facfe 100%);
            color: #ffffff;
            box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4), 0 0 20px rgba(56, 239, 125, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .switch-btn:hover {
            transform: translateY(-3px) scale(1.05);
        }
        
        .switch-btn.off:hover {
            box-shadow: 0 12px 35px rgba(255, 65, 108, 0.6), 0 0 30px rgba(255, 75, 43, 0.5);
        }
        
        .switch-btn.on:hover {
            box-shadow: 0 12px 35px rgba(17, 153, 142, 0.6), 0 0 30px rgba(56, 239, 125, 0.5);
        }
        
        @keyframes glow {
            from { box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4), 0 0 20px rgba(56, 239, 125, 0.3); }
            to { box-shadow: 0 8px 25px rgba(17, 153, 142, 0.6), 0 0 30px rgba(56, 239, 125, 0.6); }
        }
         
        /* ËøûÊé•Áä∂ÊÄÅÊ†∑Âºè */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 16px;
        }
         
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
            position: relative;
        }
        
        .status-indicator::before {
            content: '';
            position: relative;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4757;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.6);
            transition: all 0.4s ease;
            flex-shrink: 0;
        }
        
        .status-indicator.connected::before {
            background: #2ed573;
            box-shadow: 0 0 15px rgba(46, 213, 115, 0.6);
            animation: connectedPulse 2s ease-in-out infinite;
        }
        
        .status-indicator.connecting::before {
            background: #ffa502;
            box-shadow: 0 0 15px rgba(255, 165, 2, 0.6);
            animation: connectingBlink 1s ease-in-out infinite;
        }
        
        @keyframes connectedPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }
        
        @keyframes connectingBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        #connectionStatus {
            font-size: 12px;
            font-weight: 600;
            color: #ffffff;
            margin-left: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
         
        .disconnect-btn {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 50%, #ff6b9d 100%);
            color: #ffffff;
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.4), 0 0 20px rgba(255, 75, 43, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .disconnect-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .disconnect-btn:hover::before {
            left: 100%;
        }
         
        .disconnect-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(255, 65, 108, 0.6), 0 0 30px rgba(255, 75, 43, 0.5);
        }
        
        /* ÊªëÂùóÊ†∑Âºè */
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            margin: 16px 0;
            border: none;
            backdrop-filter: blur(10px);
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .control-group span {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            margin-top: 8px;
            display: inline-block;
            letter-spacing: 0.02em;
        }
        
        /* Êéß‰ª∂ÁΩëÊ†ºÂ∏ÉÂ±Ä */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            margin-top: 20px;
        }
        
        .sliders-section {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }
        
        .color-section {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        /* Ë∞ÉËâ≤ÁõòÊ†∑Âºè */
        .color-picker-control {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .color-wheel-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        #colorWheel {
            border-radius: 50%;
            cursor: crosshair;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .color-picker {
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 10;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .color-info {
            display: flex;
            justify-content: center;
        }
        
        .selected-color {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background-color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* ÂõæÊ†áÊ†∑Âºè */
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: url(https://fonts.gstatic.com/s/materialicons/v139/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2');
        }

        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 20px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
            color: #4a5568;
        }
        
        /* ÊéßÂà∂ÁªÑÊ†áÁ≠æÊ†∑Âºè */
        .control-group label {
            display: block;
            margin-bottom: 12px;
            color: #2d3748;
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.025em;
        }
        
        .color-picker-control label {
            display: block;
            margin-bottom: 20px;
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.025em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ê†áÈ¢òÂíåÁä∂ÊÄÅË°å -->
        <div class="header-row">
            <h1>LED CONTROL</h1>
            <div class="connection-status">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="connectionStatus">DISCONNECTED</span>
                </div>
            </div>
        </div>
        
        <!-- ËøûÊé•ÊåâÈíÆ -->
        <div class="button-group">
            <button class="connect-button usb-button" id="usbConnect">
                <span class="material-icons">usb</span> <span id="usbText">USB</span>
            </button>
            <button class="connect-button ble-button" id="bleConnect">
                <span class="material-icons">bluetooth</span> <span id="bleText">BLE</span>
            </button>
        </div>
        

        <!-- ÂºÄÂÖ≥Êéß‰ª∂Ë°å -->
        <div class="switches-row">
            <div class="control-group">
                <label>üí° LED:</label>
                <button id="ledSwitch" class="switch-btn off" data-state="off">
                    <span class="switch-text">üí°</span>
                </button>
            </div>
            
            <div class="control-group">
                <label>üåä BREATH:</label>
                <button id="breatheSwitch" class="switch-btn off" data-state="off">
                    <span class="switch-text">üåä</span>
                </button>
            </div>
        </div>
        
        <!-- ÊªëÂùóÂíåË∞ÉËâ≤ÁõòÁΩëÊ†ºÂ∏ÉÂ±Ä -->
        <div class="controls-grid">
            <div class="sliders-section">
                <div class="control-group">
                    <label>‚ö° FREQUENCY:</label>
                    <input type="range" id="breathePeriod" min="100" max="5000" value="1000" class="slider">
                    <span id="breathePeriodValue">1000MS</span>
                </div>
                
                <div class="control-group">
                    <label>‚òÄÔ∏è BRIGHTNESS:</label>
                    <input type="range" id="brightness" min="0" max="100" value="50" step="1" class="slider">
                    <span id="brightnessValue">50%</span>
                </div>
            </div>
            
            <div class="color-section">
                <div class="color-picker-control">
                    <label>üé® COLOR:</label>
                    <div class="color-wheel-container">
                        <canvas id="colorWheel" width="180" height="180"></canvas>
                        <div class="color-picker" id="colorPicker"></div>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <script>
        // ‰∫ÆÂ∫¶ÊªëÂùóÂäüËÉΩ

        
        // ÂÖ®Â±ÄÂèòÈáè
        let serialPort = null;
        let serialReader = null;
        let bluetoothDevice = null;
        let bluetoothCharacteristic = null;
        
        // Ë∞ÉËâ≤ÁõòÂäüËÉΩ
        const colorWheel = document.getElementById('colorWheel');
        const colorPicker = document.getElementById('colorPicker');
        // const selectedColor = document.getElementById('selectedColor'); // Â∑≤ÁßªÈô§selectedColorÂÖÉÁ¥†
        const rgbValue = null; // ÁßªÈô§ÂØπÂ∑≤Âà†Èô§ÂÖÉÁ¥†ÁöÑÂºïÁî®
        const hexValue = null; // ÁßªÈô§ÂØπÂ∑≤Âà†Èô§ÂÖÉÁ¥†ÁöÑÂºïÁî®
        const ctx = colorWheel.getContext('2d');
     let currentColor = { r: 255, g: 255, b: 255 };
        
        // ÁªòÂà∂HSVÈ¢úËâ≤ËΩÆ
         function drawColorWheel() {
             const centerX = colorWheel.width / 2;
             const centerY = colorWheel.height / 2;
             const radius = Math.min(centerX, centerY) - 10;
             
             // Ê∏ÖÈô§ÁîªÂ∏É
             ctx.clearRect(0, 0, colorWheel.width, colorWheel.height);
             
             // ‰ΩøÁî®ÂÉèÁ¥†Á∫ßÁªòÂà∂ÂàõÂª∫Âπ≥ÊªëÁöÑÈ¢úËâ≤ËΩÆ
             const imageData = ctx.createImageData(colorWheel.width, colorWheel.height);
             const data = imageData.data;
             
             for (let y = 0; y < colorWheel.height; y++) {
                 for (let x = 0; x < colorWheel.width; x++) {
                     const dx = x - centerX;
                     const dy = y - centerY;
                     const distance = Math.sqrt(dx * dx + dy * dy);
                     
                     if (distance <= radius) {
                         // ËÆ°ÁÆóËßíÂ∫¶ÂíåÈ•±ÂíåÂ∫¶
                         let angle = Math.atan2(dy, dx);
                         if (angle < 0) angle += 2 * Math.PI;
                         const hue = (angle / (2 * Math.PI)) * 360;
                         const saturation = Math.min(distance / radius, 1) * 100;
                         // Âõ∫ÂÆö‰∫ÆÂ∫¶‰∏∫50%
                         const lightness = 50;
                         
                         // ËΩ¨Êç¢HSLÂà∞RGB
                         const rgb = hslToRgb(hue, saturation, lightness);
                         
                         const index = (y * colorWheel.width + x) * 4;
                         data[index] = rgb.r;     // Red
                         data[index + 1] = rgb.g; // Green
                         data[index + 2] = rgb.b; // Blue
                         data[index + 3] = 255;   // Alpha
                     } else {
                         // ÂúÜÂΩ¢Â§ñÈÉ®ËÆæ‰∏∫ÈÄèÊòé
                         const index = (y * colorWheel.width + x) * 4;
                         data[index + 3] = 0; // ÈÄèÊòé
                     }
                 }
             }
             
             ctx.putImageData(imageData, 0, 0);
         }
        
        // HSLËΩ¨RGB
        function hslToRgb(h, s, l) {
            h /= 360;
            s /= 100;
            l /= 100;
            
            const c = (1 - Math.abs(2 * l - 1)) * s;
            const x = c * (1 - Math.abs((h * 6) % 2 - 1));
            const m = l - c / 2;
            
            let r, g, b;
            
            if (0 <= h && h < 1/6) {
                r = c; g = x; b = 0;
            } else if (1/6 <= h && h < 2/6) {
                r = x; g = c; b = 0;
            } else if (2/6 <= h && h < 3/6) {
                r = 0; g = c; b = x;
            } else if (3/6 <= h && h < 4/6) {
                r = 0; g = x; b = c;
            } else if (4/6 <= h && h < 5/6) {
                r = x; g = 0; b = c;
            } else {
                r = c; g = 0; b = x;
            }
            
            return {
                r: Math.round((r + m) * 255),
                g: Math.round((g + m) * 255),
                b: Math.round((b + m) * 255)
            };
        }
        
        // RGBËΩ¨HEX
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        }
        
        // Êõ¥Êñ∞È¢úËâ≤ÊòæÁ§∫
        function updateColorDisplay(color) {
            currentColor = color;
            // selectedColor.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`; // Â∑≤ÁßªÈô§selectedColorÂÖÉÁ¥†
            
            // ÂèëÈÄÅÈ¢úËâ≤Êï∞ÊçÆ
            sendColorData(color);
        }
        
        // ÊãñÊãΩÁä∂ÊÄÅ
        let isDragging = false;
        
        // Â§ÑÁêÜÈ¢úËâ≤ÈÄâÊã©ÁöÑÈÄöÁî®ÂáΩÊï∞
        function handleColorSelection(e) {
            const rect = colorWheel.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const centerX = colorWheel.width / 2;
            const centerY = colorWheel.height / 2;
            const dx = x - centerX;
            const dy = y - centerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const radius = Math.min(centerX, centerY) - 10;
            
            // Âè™Âú®ÂúÜÂΩ¢Âå∫ÂüüÂÜÖÂ§ÑÁêÜ
            if (distance <= radius) {
                // ËÆ°ÁÆóËßíÂ∫¶ÂíåÈ•±ÂíåÂ∫¶
                let angle = Math.atan2(dy, dx);
                if (angle < 0) angle += 2 * Math.PI;
                const hue = (angle / (2 * Math.PI)) * 360;
                const saturation = Math.min(distance / radius, 1) * 100;
                const lightness = 50;
                
                const color = hslToRgb(hue, saturation, lightness);
                updateColorDisplay(color);
                
                // Êõ¥Êñ∞ÈÄâÊã©Âô®‰ΩçÁΩÆ
                colorPicker.style.left = x + 'px';
                colorPicker.style.top = y + 'px';
                
                return true;
            }
            return false;
        }
        
        // Èº†Ê†áÊåâ‰∏ã‰∫ã‰ª∂
        colorWheel.addEventListener('mousedown', function(e) {
            if (handleColorSelection(e)) {
                isDragging = true;
                colorWheel.style.cursor = 'grabbing';
            }
        });
        
        // Èº†Ê†áÁßªÂä®‰∫ã‰ª∂
        colorWheel.addEventListener('mousemove', function(e) {
            if (isDragging) {
                handleColorSelection(e);
            } else {
                // Ê£ÄÊü•Èº†Ê†áÊòØÂê¶Âú®È¢úËâ≤ËΩÆÂÜÖ
                const rect = colorWheel.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = colorWheel.width / 2;
                const centerY = colorWheel.height / 2;
                const radius = Math.min(centerX, centerY) - 10;
                const dx = x - centerX;
                const dy = y - centerY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance <= radius) {
                    colorWheel.style.cursor = 'grab';
                } else {
                    colorWheel.style.cursor = 'default';
                }
            }
        });
        
        // Èº†Ê†áÊä¨Ëµ∑‰∫ã‰ª∂
        colorWheel.addEventListener('mouseup', function() {
            isDragging = false;
            colorWheel.style.cursor = 'grab';
        });
        
        // Èº†Ê†áÁ¶ªÂºÄ‰∫ã‰ª∂
        colorWheel.addEventListener('mouseleave', function() {
            isDragging = false;
            colorWheel.style.cursor = 'default';
        });
        
        // Â§ÑÁêÜÈ¢úËâ≤ËΩÆÁÇπÂáªÔºà‰øùÊåÅÂêëÂêéÂÖºÂÆπÔºâ
        colorWheel.addEventListener('click', function(e) {
            if (!isDragging) {
                handleColorSelection(e);
            }
        });
        
        // ËìùÁâôÂíå‰∏≤Âè£ÈÄö‰ø°ÂèòÈáè
         const CHARACTERISTIC_UUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';
         
         // ËøûÊé•Áä∂ÊÄÅÁÆ°ÁêÜ
         let connectionType = null; // 'bluetooth' Êàñ 'serial'
         let isConnected = false;
         
         // Êõ¥Êñ∞ËøûÊé•Áä∂ÊÄÅÊòæÁ§∫
         function updateConnectionStatus(status, type = null) {
             const statusIndicator = document.querySelector('.status-indicator');
             const connectionStatus = document.getElementById('connectionStatus');
             const usbButton = document.getElementById('usbConnect');
             const bleButton = document.getElementById('bleConnect');
             const usbText = document.getElementById('usbText');
             const bleText = document.getElementById('bleText');
             
             // Ê∏ÖÈô§ÊâÄÊúâÁä∂ÊÄÅÁ±ª
             statusIndicator.className = 'status-indicator';
             usbButton.className = 'connect-button usb-button';
             bleButton.className = 'connect-button ble-button';
             
             switch(status) {
                 case 'disconnected':
                     connectionStatus.textContent = 'DISCONNECTED';
                     usbText.textContent = 'USB';
                     bleText.textContent = 'BLE';
                     isConnected = false;
                     connectionType = null;
                     break;
                 case 'connecting':
                     connectionStatus.textContent = 'CONNECTING';
                     statusIndicator.classList.add('connecting');
                     if (type === 'serial') {
                         usbText.textContent = 'ËøûÊé•‰∏≠...';
                     } else if (type === 'bluetooth') {
                         bleText.textContent = 'ËøûÊé•‰∏≠...';
                     }
                     isConnected = false;
                     break;
                 case 'connected':
                     connectionStatus.textContent = type === 'serial' ? 'USB CONNECTED' : 'BLE CONNECTED';
                     statusIndicator.classList.add('connected');
                     if (type === 'serial') {
                         usbButton.classList.add('connected');
                         usbText.textContent = 'Êñ≠ÂºÄUSB';
                         bleText.textContent = 'BLE';
                     } else if (type === 'bluetooth') {
                         bleButton.classList.add('connected');
                         bleText.textContent = 'Êñ≠ÂºÄBLE';
                         usbText.textContent = 'USB';
                     }
                     isConnected = true;
                     connectionType = type;
                     break;
             }
             
             // Êõ¥Êñ∞Êéß‰ª∂Áä∂ÊÄÅ
             updateControlsState();
         }
         
         // Êõ¥Êñ∞Êéß‰ª∂ÂêØÁî®/Á¶ÅÁî®Áä∂ÊÄÅ
         function updateControlsState() {
             const controls = [
                 'ledSwitch', 'breatheSwitch', 'breathePeriod', 'brightness'
             ];
             
             controls.forEach(id => {
                 const element = document.getElementById(id);
                 if (element) {
                     element.disabled = !isConnected;
                     if (!isConnected) {
                         element.style.opacity = '0.5';
                         element.style.pointerEvents = 'none';
                     } else {
                         element.style.opacity = '1';
                         element.style.pointerEvents = 'auto';
                     }
                 }
             });
             
             // Á¶ÅÁî®/ÂêØÁî®Ë∞ÉËâ≤Áõò
             const canvas = document.getElementById('colorWheel');
             if (canvas) {
                 if (!isConnected) {
                     canvas.style.opacity = '0.5';
                     canvas.style.pointerEvents = 'none';
                 } else {
                     canvas.style.opacity = '1';
                     canvas.style.pointerEvents = 'auto';
                 }
             }
             
             // Á°Æ‰øùËøûÊé•ÊåâÈíÆÂßãÁªàÂèØÁî®
             const bleConnect = document.getElementById('bleConnect');
             const usbConnect = document.getElementById('usbConnect');
             
             if (bleConnect) {
                 bleConnect.style.opacity = '1';
                 bleConnect.style.pointerEvents = 'auto';
                 bleConnect.disabled = false;
             }
             
             if (usbConnect) {
                 usbConnect.style.opacity = '1';
                 usbConnect.style.pointerEvents = 'auto';
                 usbConnect.disabled = false;
             }
         }
        
        // ËìùÁâôËøûÊé•ÂäüËÉΩ
         async function connectBluetooth() {
             // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÂÖ∂‰ªñËøûÊé•
             if (isConnected && connectionType === 'serial') {
                 alert('ËØ∑ÂÖàÊñ≠ÂºÄUSBËøûÊé•');
                 return;
             }
             
             if (isConnected && connectionType === 'bluetooth') {
                 alert('ËìùÁâôÂ∑≤ËøûÊé•');
                 return;
             }
             
             updateConnectionStatus('connecting');
             
             try {
                 bluetoothDevice = await navigator.bluetooth.requestDevice({
                     filters: [{ services: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e'] }]
                 });
                 
                 const server = await bluetoothDevice.gatt.connect();
                 const service = await server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
                 bluetoothCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
                 
                 console.log('ËìùÁâôËøûÊé•ÊàêÂäü');
                 updateConnectionStatus('connected', 'bluetooth');
                 
                 // ÁõëÂê¨Êñ≠ÂºÄ‰∫ã‰ª∂
                 bluetoothDevice.addEventListener('gattserverdisconnected', () => {
                     console.log('ËìùÁâôËÆæÂ§áÊñ≠ÂºÄËøûÊé•');
                     bluetoothDevice = null;
                     bluetoothCharacteristic = null;
                     updateConnectionStatus('disconnected');
                 });
                 
             } catch (error) {
                 console.error('ËìùÁâôËøûÊé•Â§±Ë¥•:', error);
                 updateConnectionStatus('disconnected');
                 
                 // Â¶ÇÊûúÁî®Êà∑ÂèñÊ∂àÈÄâÊã©ËÆæÂ§áÔºå‰∏çÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                 if (error.name !== 'NotFoundError' && !error.message.includes('User cancelled')) {
                     alert('ËìùÁâôËøûÊé•Â§±Ë¥•: ' + error.message);
                 }
             }
         }
         
         // ‰∏≤Âè£ËøûÊé•ÂäüËÉΩ
         async function connectSerial() {
             // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÂÖ∂‰ªñËøûÊé•
             if (isConnected && connectionType === 'bluetooth') {
                 alert('ËØ∑ÂÖàÊñ≠ÂºÄËìùÁâôËøûÊé•');
                 return;
             }
             
             if (isConnected && connectionType === 'serial') {
                 alert('USBÂ∑≤ËøûÊé•');
                 return;
             }
             
             updateConnectionStatus('connecting');
             
             try {
                 serialPort = await navigator.serial.requestPort();
                 await serialPort.open({ baudRate: 115200 });
                 console.log('‰∏≤Âè£ËøûÊé•ÊàêÂäü');
                 updateConnectionStatus('connected', 'serial');
             } catch (error) {
                 console.error('‰∏≤Âè£ËøûÊé•Â§±Ë¥•:', error);
                 updateConnectionStatus('disconnected');
                 alert('‰∏≤Âè£ËøûÊé•Â§±Ë¥•: ' + error.message);
             }
         }
        
        // Êñ≠ÂºÄËøûÊé•ÂäüËÉΩ
        async function disconnect() {
            try {
                if (connectionType === 'bluetooth' && bluetoothDevice) {
                    stopBluetoothConnectionMonitor();
                    if (bluetoothDevice.gatt.connected) {
                        bluetoothDevice.gatt.disconnect();
                    }
                    bluetoothDevice = null;
                    bluetoothCharacteristic = null;
                    console.log('ËìùÁâôËøûÊé•Â∑≤Êñ≠ÂºÄ');
                } else if (connectionType === 'serial' && serialPort) {
                    console.log('Ê≠£Âú®ÂÖ≥Èó≠‰∏≤Âè£ËøûÊé•...');
                    
                    // ÂÖàÂèñÊ∂àÂπ∂ÈáäÊîæreader
                    if (serialReader) {
                        try {
                            await serialReader.cancel();
                            serialReader.releaseLock();
                        } catch (e) {
                            console.log('ReaderÂèñÊ∂àÂ§±Ë¥•ÔºåÂèØËÉΩÂ∑≤ÁªèË¢´ÈáäÊîæ:', e.message);
                        }
                        serialReader = null;
                    }
                    
                    // ÁÑ∂ÂêéÂÖ≥Èó≠‰∏≤Âè£
                    await serialPort.close();
                    serialPort = null;
                    console.log('‰∏≤Âè£ËøûÊé•Â∑≤Êñ≠ÂºÄ');
                    // Á≠âÂæÖ‰∏ÄÂ∞èÊÆµÊó∂Èó¥Á°Æ‰øùÁ´ØÂè£ÂÆåÂÖ®ÈáäÊîæ
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                updateConnectionStatus('disconnected');
            } catch (error) {
                console.error('Êñ≠ÂºÄËøûÊé•Â§±Ë¥•:', error);
                // Âç≥‰ΩøÊñ≠ÂºÄÂ§±Ë¥•Ôºå‰πüË¶ÅÈáçÁΩÆÂèòÈáèÂíåÁä∂ÊÄÅ
                if (connectionType === 'serial') {
                    serialPort = null;
                    serialReader = null;
                }
                updateConnectionStatus('disconnected');
            }
        }
        
        // ËìùÁâôÂèëÈÄÅ‰∫íÊñ•ÈîÅ
        let isSendingBluetooth = false;
        
        // ÂèëÈÄÅÊåá‰ª§Âà∞ËÆæÂ§á
        async function sendCommand(command) {
            if (!isConnected) {
                console.warn('ËÆæÂ§áÊú™ËøûÊé•ÔºåÊó†Ê≥ïÂèëÈÄÅÊåá‰ª§');
                return;
            }
            
            console.log('ÂèëÈÄÅÊåá‰ª§:', command);
            
            // ËìùÁâôÂèëÈÄÅ
            if (bluetoothCharacteristic) {
                // Â¶ÇÊûúÊ≠£Âú®ÂèëÈÄÅÔºåË∑≥ËøáËøôÊ¨°ÂèëÈÄÅ
                if (isSendingBluetooth) {
                    console.log('ËìùÁâôÊ≠£Âú®ÂèëÈÄÅ‰∏≠ÔºåË∑≥Ëøá:', command);
                    return;
                }
                
                isSendingBluetooth = true;
                try {
                    const encoder = new TextEncoder();
                    await bluetoothCharacteristic.writeValue(encoder.encode(command));
                    console.log('ËìùÁâôÂèëÈÄÅÊàêÂäü:', command);
                } catch (error) {
                    console.error('ËìùÁâôÂèëÈÄÅÂ§±Ë¥•:', error);
                    // Âè™ÊúâÂú®ËøûÊé•ÁúüÊ≠£Êñ≠ÂºÄÊó∂ÊâçÊõ¥Êñ∞Áä∂ÊÄÅ
                    if (error.name === 'NetworkError' || error.message.includes('GATT Server is disconnected')) {
                        updateConnectionStatus('disconnected');
                    }
                } finally {
                    isSendingBluetooth = false;
                }
            }
            
            // ‰∏≤Âè£ÂèëÈÄÅ
            if (serialPort && serialPort.writable) {
                try {
                    const writer = serialPort.writable.getWriter();
                    const encoder = new TextEncoder();
                    await writer.write(encoder.encode(command + '\n'));
                    writer.releaseLock();
                    console.log('‰∏≤Âè£ÂèëÈÄÅÊàêÂäü:', command);
                } catch (error) {
                    console.error('‰∏≤Âè£ÂèëÈÄÅÂ§±Ë¥•:', error);
                    // Âè™ÊúâÂú®Á´ØÂè£ÁúüÊ≠£Êñ≠ÂºÄÊó∂ÊâçÊõ¥Êñ∞Áä∂ÊÄÅ
                    if (error.name === 'NetworkError' || !serialPort.readable) {
                        updateConnectionStatus('disconnected');
                    }
                }
            }
        }
        
        // È¢úËâ≤ÂèëÈÄÅÈò≤ÊäñÂÆöÊó∂Âô®
        let colorSendTimer = null;
        // ‰∫ÆÂ∫¶ÂèëÈÄÅÈò≤ÊäñÂÆöÊó∂Âô®
        let brightnessSendTimer = null;
        
        // ÂèëÈÄÅÈ¢úËâ≤Êï∞ÊçÆ
        function sendColorData(color) {
            if (color) {
                // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
                if (colorSendTimer) {
                    clearTimeout(colorSendTimer);
                }
                
                // ËÆæÁΩÆÊñ∞ÁöÑÂÆöÊó∂Âô®Ôºå10msÂêéÂèëÈÄÅÔºàËøõ‰∏ÄÊ≠•Âä†Âø´ÂìçÂ∫îÈÄüÂ∫¶Ôºâ
                colorSendTimer = setTimeout(() => {
                    const command = `${color.r},${color.g},${color.b}`;
                    sendCommand(command);
                    colorSendTimer = null;
                }, 10);
            }
        }
        
        // ÂèëÈÄÅ‰∫ÆÂ∫¶Êï∞ÊçÆÔºàÂ∏¶Èò≤ÊäñÔºâ
        function sendBrightnessData(value) {
            // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
            if (brightnessSendTimer) {
                clearTimeout(brightnessSendTimer);
            }
            
            // ËÆæÁΩÆÊñ∞ÁöÑÂÆöÊó∂Âô®Ôºå300msÂêéÂèëÈÄÅÔºàÈôç‰ΩéÈ¢ëÁéáÔºâ
            brightnessSendTimer = setTimeout(() => {
                sendCommand('BRIGHT ' + value + '%');
                brightnessSendTimer = null;
            }, 300);
        }
        

        
        // LEDÂºÄÂÖ≥‰∫ã‰ª∂Â§ÑÁêÜ
        document.getElementById('ledSwitch').addEventListener('click', function() {
            const btn = this;
            const currentState = btn.getAttribute('data-state');
            
            if (currentState === 'off') {
                btn.setAttribute('data-state', 'on');
                btn.className = 'switch-btn on';
                if (btn.id === 'ledSwitch') {
                    btn.querySelector('.switch-text').textContent = 'üí°';
                } else if (btn.id === 'breatheSwitch') {
                    btn.querySelector('.switch-text').textContent = 'üåä';
                }
                sendCommand('ON');
            } else {
                btn.setAttribute('data-state', 'off');
                btn.className = 'switch-btn off';
                if (btn.id === 'ledSwitch') {
                    btn.querySelector('.switch-text').textContent = 'üí°';
                } else if (btn.id === 'breatheSwitch') {
                    btn.querySelector('.switch-text').textContent = 'üåä';
                }
                sendCommand('OFF');
            }
        });
        
        // ÂëºÂê∏ÁÅØÂºÄÂÖ≥‰∫ã‰ª∂Â§ÑÁêÜ
        document.getElementById('breatheSwitch').addEventListener('click', function() {
            const btn = this;
            const currentState = btn.getAttribute('data-state');
            
            if (currentState === 'off') {
                btn.setAttribute('data-state', 'on');
                btn.className = 'switch-btn on';
                btn.querySelector('.switch-text').textContent = 'üåä';
                sendCommand('BREATHE ON');
            } else {
                btn.setAttribute('data-state', 'off');
                btn.className = 'switch-btn off';
                btn.querySelector('.switch-text').textContent = 'üåä';
                sendCommand('BREATHE OFF');
            }
        });
        
        // Èó™ÁÉÅÈ¢ëÁéáÊªëÂùó‰∫ã‰ª∂Â§ÑÁêÜ
         document.getElementById('breathePeriod').addEventListener('input', function() {
             const value = this.value;
             document.getElementById('breathePeriodValue').textContent = value + 'ms';
             sendCommand('BREATHE PERIOD ' + value);
         });
         
         // ‰∫ÆÂ∫¶ÊªëÂùó‰∫ã‰ª∂Â§ÑÁêÜ
         document.getElementById('brightness').addEventListener('input', function() {
             const value = this.value;
             document.getElementById('brightnessValue').textContent = value + '%';
             sendBrightnessData(value);
         });
        
        // ÂàùÂßãÂåñË∞ÉËâ≤Áõò
        drawColorWheel();
        
        // ËÆæÁΩÆÂàùÂßãÈÄâÊã©Âô®‰ΩçÁΩÆÔºà‰∏≠ÂøÉÁôΩËâ≤Ôºâ
         colorPicker.style.left = (colorWheel.width / 2) + 'px';
         colorPicker.style.top = (colorWheel.height / 2) + 'px';
         updateColorDisplay(currentColor);
         
         // ÂàùÂßãÂåñËøûÊé•Áä∂ÊÄÅ
         updateConnectionStatus('disconnected');
        
        // ËøûÊé•ÊåâÈíÆ‰∫ã‰ª∂Â∑≤Êï¥ÂêàÂà∞USBÂíåBLEÊåâÈíÆ‰∏≠
        
        // USBËøûÊé•ÊåâÈíÆ
        document.getElementById('usbConnect').addEventListener('click', async function() {
            try {
                // Â¶ÇÊûúÂ∑≤ËøûÊé•‰∏îÊòØUSBËøûÊé•ÔºåÂàôÊñ≠ÂºÄ
                if (isConnected && connectionType === 'serial') {
                    await disconnect();
                    return;
                }
                
                // Â¶ÇÊûúÂ∑≤ËøûÊé•‰ΩÜÊòØÂÖ∂‰ªñÁ±ªÂûãÔºåÊèêÁ§∫Áî®Êà∑
                if (isConnected && connectionType !== 'serial') {
                    showCustomAlert('ËØ∑ÂÖàÊñ≠ÂºÄÂΩìÂâçËøûÊé•', 'warning', 'ËøûÊé•ÂÜ≤Á™Å');
                    return;
                }
                
                // Ê£ÄÊü•ÊµèËßàÂô®ÊòØÂê¶ÊîØÊåÅWeb Serial API
                if (!('serial' in navigator)) {
                    showCustomAlert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅWeb Serial APIÔºåËØ∑‰ΩøÁî®ChromeÊàñEdgeÊµèËßàÂô®', 'warning', 'ÊµèËßàÂô®‰∏çÊîØÊåÅ');
                    return;
                }
                
                updateConnectionStatus('connecting', 'serial');
                
                // ËØ∑Ê±Ç‰∏≤Âè£ÊùÉÈôê
                serialPort = await navigator.serial.requestPort();
                
                // ÊâìÂºÄ‰∏≤Âè£ËøûÊé•
                await serialPort.open({ 
                    baudRate: 115200,
                    dataBits: 8,
                    stopBits: 1,
                    parity: 'none'
                });
                
                showToast('USBËøûÊé•ÊàêÂäüÔºÅ', 'success', 'ËøûÊé•ÊàêÂäü');
                
                // Êõ¥Êñ∞ËøûÊé•Áä∂ÊÄÅ
                updateConnectionStatus('connected', 'serial');
                
                // ÁõëÂê¨‰∏≤Âè£Êï∞ÊçÆ
                readSerialData();
                
                // ‰∏ªÂä®Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅ
                console.log('ÂèëÈÄÅGET STATEÂëΩ‰ª§Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅ');
                await sendSerialData('GET STATE\n');
                
            } catch (error) {
                console.error('USBÊìç‰ΩúÂ§±Ë¥•:', error);
                updateConnectionStatus('disconnected');
            }
        });
        
        // BLEËøûÊé•ÊåâÈíÆ
        document.getElementById('bleConnect').addEventListener('click', async function() {
            try {
                // Â¶ÇÊûúÂ∑≤ËøûÊé•‰∏îÊòØBLEËøûÊé•ÔºåÂàôÊñ≠ÂºÄ
                if (isConnected && connectionType === 'bluetooth') {
                    await disconnect();
                    return;
                }
                
                // Â¶ÇÊûúÂ∑≤ËøûÊé•‰ΩÜÊòØÂÖ∂‰ªñÁ±ªÂûãÔºåÊèêÁ§∫Áî®Êà∑
                 if (isConnected && connectionType !== 'bluetooth') {
                     showCustomAlert('ËØ∑ÂÖàÊñ≠ÂºÄÂΩìÂâçËøûÊé•', 'warning', 'ËøûÊé•ÂÜ≤Á™Å');
                     return;
                 }
                
                // Ê£ÄÊü•ÊµèËßàÂô®ÊòØÂê¶ÊîØÊåÅWeb Bluetooth API
                if (!('bluetooth' in navigator)) {
                    showCustomAlert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅWeb Bluetooth APIÔºåËØ∑‰ΩøÁî®ChromeÊàñEdgeÊµèËßàÂô®', 'warning', 'ÊµèËßàÂô®‰∏çÊîØÊåÅ');
                    return;
                }
                
                updateConnectionStatus('connecting', 'bluetooth');
                
                // ËØ∑Ê±ÇËìùÁâôËÆæÂ§á
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    filters: [{
                        name: 'Led-Box-BLE'
                    }],
                    optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
                });
                
                // ËøûÊé•Âà∞GATTÊúçÂä°Âô®
                const server = await bluetoothDevice.gatt.connect();
                
                // Ëé∑ÂèñÊúçÂä°
                const service = await server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
                
                // Ëé∑ÂèñÁâπÂæÅÂÄº
                bluetoothCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
                
                // ÂêØÁî®ÈÄöÁü•‰ª•Êé•Êî∂Êù•Ëá™ArduinoÁöÑÊï∞ÊçÆ
                console.log('ÂêØÁî®ËìùÁâôÈÄöÁü•...');
                await bluetoothCharacteristic.startNotifications();
                console.log('ËìùÁâôÈÄöÁü•Â∑≤ÂêØÁî®');
                bluetoothCharacteristic.addEventListener('characteristicvaluechanged', handleBluetoothMessage);
                console.log('ËìùÁâôÊ∂àÊÅØÁõëÂê¨Âô®Â∑≤Ê∑ªÂä†');
                
                // ‰∏ªÂä®Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅ
                console.log('ÂèëÈÄÅGET STATEÂëΩ‰ª§Ëé∑ÂèñËÆæÂ§áÁä∂ÊÄÅ');
                await sendBluetoothData('GET STATE');
                
                showToast('BLEËøûÊé•ÊàêÂäüÔºÅ', 'success', 'ËøûÊé•ÊàêÂäü');
                
                // Êõ¥Êñ∞ËøûÊé•Áä∂ÊÄÅ
                updateConnectionStatus('connected', 'bluetooth');
                
                // ÁõëÂê¨ËìùÁâôËÆæÂ§áÊñ≠ÂºÄ
                bluetoothDevice.addEventListener('gattserverdisconnected', () => {
                    console.log('ËìùÁâôËÆæÂ§áÊñ≠ÂºÄËøûÊé•');
                    bluetoothDevice = null;
                    bluetoothCharacteristic = null;
                    updateConnectionStatus('disconnected');
                    showToast('BLEËÆæÂ§áÂ∑≤Êñ≠ÂºÄËøûÊé•', 'warning', 'ËøûÊé•Êñ≠ÂºÄ');
                });
                
                // ÂêØÂä®ËìùÁâôËøûÊé•Áä∂ÊÄÅÁõëÊéß
                startBluetoothConnectionMonitor();
                
            } catch (error) {
                console.error('BLEÊìç‰ΩúÂ§±Ë¥•:', error);
                updateConnectionStatus('disconnected');
                
                // Â¶ÇÊûúÁî®Êà∑ÂèñÊ∂àÈÄâÊã©ËÆæÂ§áÔºå‰∏çÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                if (error.name !== 'NotFoundError' && !error.message.includes('User cancelled')) {
                    showCustomAlert('BLEÊìç‰ΩúÂ§±Ë¥•: ' + error.message, 'error', 'Êìç‰ΩúÂ§±Ë¥•');
                }
            }
        });
        
        // ËØªÂèñ‰∏≤Âè£Êï∞ÊçÆ
        async function readSerialData() {
            if (!serialPort) return;
            
            try {
                serialReader = serialPort.readable.getReader();
                
                while (true) {
                    const { value, done } = await serialReader.read();
                    if (done) break;
                    
                    // Â§ÑÁêÜÊé•Êî∂Âà∞ÁöÑÊï∞ÊçÆ
                    const receivedData = new TextDecoder().decode(value);
                    console.log('Êî∂Âà∞‰∏≤Âè£Êï∞ÊçÆ:', receivedData);
                    
                    // Â§ÑÁêÜSTATEÊ∂àÊÅØ
                    if (receivedData.includes('STATE,')) {
                        // ÂèØËÉΩÂåÖÂê´Â§öË°åÊï∞ÊçÆÔºåÈúÄË¶ÅÂàÜÂâ≤Â§ÑÁêÜ
                        const lines = receivedData.split('\n');
                        for (const line of lines) {
                            if (line.trim().startsWith('STATE,')) {
                                handleStateMessage(line.trim());
                            }
                        }
                    }
                }
                
            } catch (error) {
                console.error('ËØªÂèñ‰∏≤Âè£Êï∞ÊçÆÂ§±Ë¥•:', error);
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰∏≤Âè£Êñ≠ÂºÄÈîôËØØ
                 if (error.name === 'NetworkError' || 
                     error.message.includes('device has been lost') ||
                     error.message.includes('device was disconnected') ||
                     error.message.includes('The device has been lost')) {
                     console.log('Ê£ÄÊµãÂà∞‰∏≤Âè£ËÆæÂ§áÊñ≠ÂºÄ');
                     serialPort = null;
                     serialReader = null;
                     updateConnectionStatus('disconnected');
                     // ÁßªÈô§USBÊñ≠ÂºÄÁöÑÂºπÁ™óÈÄöÁü•ÔºåÂè™Âú®ÊéßÂà∂Âè∞ËÆ∞ÂΩï
                 }
            } finally {
                // Á°Æ‰øùÈáäÊîæreaderÈîÅÂÆö
                if (serialReader) {
                    try {
                        serialReader.releaseLock();
                    } catch (e) {
                        console.log('ReaderÂ∑≤ÁªèË¢´ÈáäÊîæ');
                    }
                    serialReader = null;
                }
            }
        }
        
        // ÂèëÈÄÅ‰∏≤Âè£Êï∞ÊçÆ
        async function sendSerialData(data) {
            if (!serialPort || !serialPort.writable) {
                console.error('‰∏≤Âè£Êú™ËøûÊé•Êàñ‰∏çÂèØÂÜô');
                return;
            }
            
            try {
                const writer = serialPort.writable.getWriter();
                const encoder = new TextEncoder();
                await writer.write(encoder.encode(data));
                writer.releaseLock();
                console.log('ÂèëÈÄÅ‰∏≤Âè£Êï∞ÊçÆ:', data);
            } catch (error) {
                console.error('ÂèëÈÄÅ‰∏≤Âè£Êï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }
        
        // ÂèëÈÄÅËìùÁâôÊï∞ÊçÆ
        async function sendBluetoothData(data) {
            if (!bluetoothCharacteristic) {
                console.error('ËìùÁâôÁâπÂæÅÂÄºÊú™ËøûÊé•');
                return;
            }
            
            try {
                const encoder = new TextEncoder();
                await bluetoothCharacteristic.writeValue(encoder.encode(data));
                console.log('ÂèëÈÄÅËìùÁâôÊï∞ÊçÆ:', data);
            } catch (error) {
                console.error('ÂèëÈÄÅËìùÁâôÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }
        
        // Â§ÑÁêÜËìùÁâôÊé•Êî∂Âà∞ÁöÑÊ∂àÊÅØ
        function handleBluetoothMessage(event) {
            console.log('ËìùÁâôÊ∂àÊÅØ‰∫ã‰ª∂Ëß¶Âèë');
            const receivedData = new TextDecoder().decode(event.target.value);
            console.log('Êî∂Âà∞ËìùÁâôÊï∞ÊçÆ:', receivedData);
            console.log('Êï∞ÊçÆÈïøÂ∫¶:', receivedData.length);
            console.log('Êï∞ÊçÆÁ±ªÂûã:', typeof receivedData);
            
            // Â§ÑÁêÜSTATEÊ∂àÊÅØ
            if (receivedData.startsWith('STATE,')) {
                console.log('Ê£ÄÊµãÂà∞STATEÊ∂àÊÅØ');
                handleStateMessage(receivedData);
            } else {
                console.log('Êî∂Âà∞ÂÖ∂‰ªñËìùÁâôÊ∂àÊÅØ:', receivedData);
            }
        }
        
        // Â§ÑÁêÜArduinoÂèëÈÄÅÁöÑÁä∂ÊÄÅÊ∂àÊÅØ
        function handleStateMessage(stateMsg) {
            try {
                // Ëß£ÊûêÁä∂ÊÄÅÊ∂àÊÅØ: STATE,isLightOn,isBreathing,r,g,b,brightness,periodMs
                const parts = stateMsg.split(',');
                if (parts.length !== 8 || parts[0] !== 'STATE') {
                    console.error('Áä∂ÊÄÅÊ∂àÊÅØÊ†ºÂºèÈîôËØØ:', stateMsg);
                    return;
                }
                
                const [, isLightOn, isBreathing, r, g, b, brightness, periodMs] = parts;
                
                console.log('Êî∂Âà∞ËÆæÂ§áÁä∂ÊÄÅ:', {
                    isLightOn: isLightOn === '1',
                    isBreathing: isBreathing === '1',
                    color: { r: parseInt(r), g: parseInt(g), b: parseInt(b) },
                    brightness: parseInt(brightness),
                    periodMs: parseInt(periodMs)
                });
                
                // Êõ¥Êñ∞ÂâçÁ´ØÁïåÈù¢Áä∂ÊÄÅ
                updateUIFromDeviceState({
                    isLightOn: isLightOn === '1',
                    isBreathing: isBreathing === '1',
                    r: parseInt(r),
                    g: parseInt(g),
                    b: parseInt(b),
                    brightness: parseInt(brightness),
                    periodMs: parseInt(periodMs)
                });
                
            } catch (error) {
                console.error('Ëß£ÊûêÁä∂ÊÄÅÊ∂àÊÅØÂ§±Ë¥•:', error, stateMsg);
            }
        }
        
        // RGBËΩ¨HSL
        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0; // achromatic
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            
            return { h: h * 360, s: s * 100, l: l * 100 };
        }
        
        // Ê†πÊçÆHSLÂÄºÊõ¥Êñ∞Ë∞ÉËâ≤ÁõòÈÄâÊã©Âô®‰ΩçÁΩÆ
        function updateColorPickerPosition(r, g, b) {
            const hsl = rgbToHsl(r, g, b);
            const centerX = colorWheel.width / 2;
            const centerY = colorWheel.height / 2;
            const radius = Math.min(centerX, centerY) - 10;
            
            // ËÆ°ÁÆóËßíÂ∫¶ÂíåË∑ùÁ¶ª
            const angle = (hsl.h / 360) * 2 * Math.PI;
            const distance = (hsl.s / 100) * radius;
            
            // ËÆ°ÁÆó‰ΩçÁΩÆ
            const x = centerX + Math.cos(angle) * distance;
            const y = centerY + Math.sin(angle) * distance;
            
            // Êõ¥Êñ∞ÈÄâÊã©Âô®‰ΩçÁΩÆ
            colorPicker.style.left = x + 'px';
            colorPicker.style.top = y + 'px';
        }
        
        // Ê†πÊçÆËÆæÂ§áÁä∂ÊÄÅÊõ¥Êñ∞ÂâçÁ´ØÁïåÈù¢
        function updateUIFromDeviceState(state) {
            // Êõ¥Êñ∞ÂºÄÂÖ≥Áä∂ÊÄÅ
            const ledSwitch = document.getElementById('ledSwitch');
            if (ledSwitch) {
                if (state.isLightOn) {
                    ledSwitch.setAttribute('data-state', 'on');
                    ledSwitch.className = 'switch-btn on';
                    ledSwitch.querySelector('.switch-text').textContent = 'üí°';
                } else {
                    ledSwitch.setAttribute('data-state', 'off');
                    ledSwitch.className = 'switch-btn off';
                    ledSwitch.querySelector('.switch-text').textContent = 'üí°';
                }
            }
            
            // Êõ¥Êñ∞ÂëºÂê∏Ê®°ÂºèÁä∂ÊÄÅ
            const breatheSwitch = document.getElementById('breatheSwitch');
            if (breatheSwitch) {
                if (state.isBreathing) {
                    breatheSwitch.setAttribute('data-state', 'on');
                    breatheSwitch.className = 'switch-btn on';
                    breatheSwitch.querySelector('.switch-text').textContent = 'üåä';
                } else {
                    breatheSwitch.setAttribute('data-state', 'off');
                    breatheSwitch.className = 'switch-btn off';
                    breatheSwitch.querySelector('.switch-text').textContent = 'üåä';
                }
            }
            
            // Êõ¥Êñ∞‰∫ÆÂ∫¶ÊªëÂùó
            const brightnessSlider = document.getElementById('brightness');
            const brightnessValue = document.getElementById('brightnessValue');
            if (brightnessSlider && brightnessValue) {
                const brightnessPercent = Math.round((state.brightness / 255) * 100);
                brightnessSlider.value = brightnessPercent;
                brightnessValue.textContent = brightnessPercent + '%';
            }
            
            // Êõ¥Êñ∞ÂëºÂê∏Âë®ÊúüÊªëÂùó
            const periodSlider = document.getElementById('breathePeriod');
            const periodValue = document.getElementById('breathePeriodValue');
            if (periodSlider && periodValue) {
                periodSlider.value = state.periodMs;
                periodValue.textContent = state.periodMs + 'ms';
            }
            
            // Êõ¥Êñ∞Ë∞ÉËâ≤ÁõòÈ¢úËâ≤ÂíåÈÄâÊã©Âô®‰ΩçÁΩÆ
            const color = { r: state.r, g: state.g, b: state.b };
            updateColorDisplay(color);
            updateColorPickerPosition(state.r, state.g, state.b);
            
            console.log('ÁïåÈù¢Áä∂ÊÄÅÂ∑≤Êõ¥Êñ∞:', state);
        }
        
        // ËìùÁâôËøûÊé•Áä∂ÊÄÅÁõëÊéß
        let bluetoothMonitorInterval = null;
        
        function startBluetoothConnectionMonitor() {
            // Ê∏ÖÈô§‰πãÂâçÁöÑÁõëÊéß
            if (bluetoothMonitorInterval) {
                clearInterval(bluetoothMonitorInterval);
            }
            
            bluetoothMonitorInterval = setInterval(() => {
                if (bluetoothDevice && connectionType === 'bluetooth') {
                    // Ê£ÄÊü•ËìùÁâôËÆæÂ§áÊòØÂê¶‰ªçÁÑ∂ËøûÊé•
                    if (!bluetoothDevice.gatt.connected) {
                        console.log('Ê£ÄÊµãÂà∞ËìùÁâôËÆæÂ§áÂ∑≤Êñ≠ÂºÄ');
                        clearInterval(bluetoothMonitorInterval);
                        bluetoothMonitorInterval = null;
                        bluetoothDevice = null;
                        bluetoothCharacteristic = null;
                        updateConnectionStatus('disconnected');
                        showToast('BLEËÆæÂ§áÂ∑≤Êñ≠ÂºÄËøûÊé•', 'warning', 'ËøûÊé•Êñ≠ÂºÄ');
                    }
                } else {
                    // Â¶ÇÊûú‰∏çÊòØËìùÁâôËøûÊé•ÔºåÂÅúÊ≠¢ÁõëÊéß
                    clearInterval(bluetoothMonitorInterval);
                    bluetoothMonitorInterval = null;
                }
            }, 1000); // ÊØè1ÁßíÊ£ÄÊü•‰∏ÄÊ¨°ÔºåÂπ≥Ë°°Ê£ÄÊµãÈÄüÂ∫¶ÂíåËøûÊé•Á®≥ÂÆöÊÄß
        }
        
        function stopBluetoothConnectionMonitor() {
            if (bluetoothMonitorInterval) {
                clearInterval(bluetoothMonitorInterval);
                bluetoothMonitorInterval = null;
            }
        }

        // ËìùÁâôËÆæÂ§áÊñ≠ÂºÄÂ§ÑÁêÜ
        function onBluetoothDisconnected() {
            console.log('ËìùÁâôËÆæÂ§áÂ∑≤Êñ≠ÂºÄ');
            bluetoothDevice = null;
            bluetoothCharacteristic = null;
            
            stopBluetoothConnectionMonitor();
            updateConnectionStatus('disconnected');
            showToast('BLEËÆæÂ§áÂ∑≤Êñ≠ÂºÄËøûÊé•', 'warning', 'ËøûÊé•Êñ≠ÂºÄ');
        }
        
        // Ëá™ÂÆö‰πâÂºπÁ™óÂáΩÊï∞
        function showCustomAlert(message, type = 'info', title = 'ÊèêÁ§∫') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const confirmBtn = document.getElementById('modalConfirm');
                const cancelBtn = document.getElementById('modalCancel');
                
                // ËÆæÁΩÆÂõæÊ†áÂíåÊ†∑Âºè
                const icons = {
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    info: '‚ÑπÔ∏è'
                };
                
                modalIcon.textContent = icons[type] || icons.info;
                modalIcon.className = `modal-icon ${type}`;
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                
                // ÈöêËóèÂèñÊ∂àÊåâÈíÆÔºàÂè™ÊòæÁ§∫Á°ÆÂÆöÊåâÈíÆÔºâ
                cancelBtn.style.display = 'none';
                
                // ÊòæÁ§∫ÂºπÁ™ó
                modal.classList.add('show');
                
                // Á°ÆÂÆöÊåâÈíÆ‰∫ã‰ª∂
                const handleConfirm = () => {
                    modal.classList.remove('show');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    resolve(true);
                };
                
                confirmBtn.addEventListener('click', handleConfirm);
                
                // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
                const handleBackdrop = (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                        modal.removeEventListener('click', handleBackdrop);
                        resolve(true);
                    }
                };
                
                modal.addEventListener('click', handleBackdrop);
            });
        }
        
        // Ëá™ÂÆö‰πâÁ°ÆËÆ§ÂºπÁ™óÂáΩÊï∞
        function showCustomConfirm(message, title = 'Á°ÆËÆ§') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customModal');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const confirmBtn = document.getElementById('modalConfirm');
                const cancelBtn = document.getElementById('modalCancel');
                
                modalIcon.textContent = '‚ùì';
                modalIcon.className = 'modal-icon warning';
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                
                // ÊòæÁ§∫ÂèñÊ∂àÊåâÈíÆ
                cancelBtn.style.display = 'inline-block';
                confirmBtn.textContent = 'Á°ÆÂÆö';
                cancelBtn.textContent = 'ÂèñÊ∂à';
                
                // ÊòæÁ§∫ÂºπÁ™ó
                modal.classList.add('show');
                
                // Á°ÆÂÆöÊåâÈíÆ‰∫ã‰ª∂
                const handleConfirm = () => {
                    modal.classList.remove('show');
                    cleanup();
                    resolve(true);
                };
                
                // ÂèñÊ∂àÊåâÈíÆ‰∫ã‰ª∂
                const handleCancel = () => {
                    modal.classList.remove('show');
                    cleanup();
                    resolve(false);
                };
                
                // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠ÔºàÁõ∏ÂΩì‰∫éÂèñÊ∂àÔºâ
                const handleBackdrop = (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                        cleanup();
                        resolve(false);
                    }
                };
                
                const cleanup = () => {
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    modal.removeEventListener('click', handleBackdrop);
                };
                
                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
                modal.addEventListener('click', handleBackdrop);
            });
        }
        
        // ÊòæÁ§∫Âè≥‰∏äËßíÈÄöÁü•
        function showToast(message, type = 'info', title = '', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            
            const iconMap = {
                success: '‚úÖ',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è',
                error: '‚ùå'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${iconMap[type] || iconMap.info}</div>
                <div class="toast-content">
                    ${title ? `<div class="toast-title">${title}</div>` : ''}
                    <div class="toast-message">${message}</div>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Ëß¶ÂèëÊòæÁ§∫Âä®Áîª
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Ëá™Âä®ÈöêËóè
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 400);
            }, duration);
        }

        // ÈáçÂÜôalertÂáΩÊï∞
        window.alert = function(message) {
            return showCustomAlert(message, 'info');
        };
        
        // ÈáçÂÜôconfirmÂáΩÊï∞
        window.confirm = function(message) {
            return showCustomConfirm(message);
        };

    </script>
    
    <!-- Ëá™ÂÆö‰πâÂºπÁ™ó -->
    <!-- Âè≥‰∏äËßíÈÄöÁü•ÂÆπÂô® -->
    <div id="toastContainer"></div>

    <div id="customModal" class="custom-modal">
        <div class="modal-content">
            <span id="modalIcon" class="modal-icon">‚ÑπÔ∏è</span>
            <div id="modalTitle" class="modal-title">ÊèêÁ§∫</div>
            <div id="modalMessage" class="modal-message">ËøôÊòØ‰∏ÄÊù°Ê∂àÊÅØ</div>
            <div class="modal-buttons">
                <button id="modalConfirm" class="modal-btn primary">Á°ÆÂÆö</button>
                <button id="modalCancel" class="modal-btn secondary" style="display: none;">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>
</body>
</html>